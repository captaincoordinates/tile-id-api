services:
  api:
    image: captaincoordinates/tile-id-api
    build:
      dockerfile: dockerfile.api
    ports:
      - ${TILE_ID_LISTEN_PORT:-8123}:8080
    volumes:
      - ./tile-id-api:/src:ro
  unittest:
    build:
      dockerfile: dockerfile.unittest
    volumes:
      - ./tile-id-api:/src:ro
    profiles:
      - unittest
  integrationtest:
    build:
      dockerfile: dockerfile.integrationtest
    volumes:
      - ./scripts/docker:/tests:ro
    depends_on:
      - api
  validateopenapi:
    build:
      dockerfile: dockerfile.validateopenapi
    volumes:
      - ./tile-id-api/openapi.yml:/openapi/openapi.yml:ro
